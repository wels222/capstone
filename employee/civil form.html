<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CS Form No. 6 - Application for Leave</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .form-container {
        max-width: 800px;
        margin: 2rem auto;
        background-color: white;
        padding: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      /* Custom styling for precise form replication */
      .form-box {
        border: 1px solid #000;
      }
      .form-input {
        width: 100%;
        border: none;
        outline: none;
        padding: 0 4px;
        line-height: 1.25rem; /* Ensure line height consistency */
      }
      .form-line {
        border-bottom: 1px solid #000;
      }
      .form-underline {
        border-bottom: 1px solid #000;
        padding-bottom: 2px;
      }
      .text-xxs {
        font-size: 0.65rem; /* For the small text in the form */
      }
      .checkbox-label {
        display: flex;
        align-items: flex-start;
        line-height: 1.1;
      }
      .checkbox-label input[type="checkbox"],
      .checkbox-label input[type="radio"] {
        margin-top: 2px;
        margin-right: 0.25rem;
        min-width: 1rem;
        min-height: 1rem;
        accent-color: #1f2937;
      }
    </style>
  </head>
  <body>
    <!-- Breadcrumb Navigation -->
    <main class="flex-grow p-4 overflow-y-auto mt-6">
      <div class="bg-white rounded-xl shadow-md p-6 mb-6">
        <div class="flex items-center text-gray-600">
          <a href="dashboard.html" class="cursor-pointer hover:text-blue-600"
            >Dashboard</a
          >
          <span class="mx-2">&gt;</span>
          <a href="apply-leave.html" class="cursor-pointer hover:text-blue-600"
            >Apply for Leave</a
          >
          <span class="mx-2">&gt;</span>
          <span id="current-leave-type"></span>
        </div>
      </div>
    </main>

    <div class="form-container">
      <!-- Header Section (FIXED to match reference image) -->
      <header class="text-xs mb-2">
        <div class="flex justify-between items-start mb-1">
          <div class="text-left leading-tight">
            <p>Civil Service Form No. 6</p>
            <p>Revised 2020</p>
          </div>
          <div class="text-right leading-tight font-bold">
            <p>ANNEX A</p>
          </div>
        </div>

        <div class="flex justify-between items-end mb-4">
          <!-- AGENCY LOGO -->
          <div class="flex items-start">
            <img
              src="../assets/logo.png"
              alt="Agency Logo"
              class="h-10 w-20 object-contain"
              onerror="this.onerror=null; this.src='https://placehold.co/40x40/DDDDDD/000?text=AGENCY%20LOGO';"
            />
          </div>

          <!-- REPUBLIC OF THE PHILIPPINES / AGENCY INFO -->
          <div class="text-center leading-tight">
            <p class="font-bold">Republic of the Philippines</p>
            <p class="font-bold text-gray-900">MUNICIPAL OFFICE OF MABINI</p>
            <p class="text-xs font-normal">Poblacion, Mabini Batangas</p>
          </div>

          <!-- Stamp of Date of Receipt (UPDATED: Box is now blank with text above/below) -->
          <div class="text-right text-xxs pt-1 leading-snug w-20">
            <div class="border border-gray-400 border-dashed w-full h-8"></div>
          </div>
        </div>

        <h1 class="text-center text-lg font-extrabold text-gray-900 mt-2">
          APPLICATION FOR LEAVE
        </h1>
      </header>

      <!-- 1-5. Employee Information Section (PERFECT ALIGNMENT FIXED HERE) -->
      <div class="text-xs form-box">
        <!-- Row 1: 1. OFFICE/DEPARTMENT and 2. NAME (Last, First, Middle) -->
        <div class="flex form-line">
          <!-- 1. OFFICE/DEPARTMENT (Approximately 40% width) - FIXED FOR ALIGNMENT -->
          <div class="w-2/5 flex flex-col p-0 h-full">
            <!-- Label Area (Fixed height h-6 to match the height of Name's (Last) label) -->
            <div class="flex items-center px-1 pt-1 h-6">
              <span class="font-bold">1. OFFICE/DEPARTMENT</span>
            </div>
            <!-- Input Area (Flex-grow to push input line down, aligning it with Name's input line) -->
            <div class="flex-grow flex items-end px-1 pb-1 pt-0">
              <!-- Input field is full width and has a visible underline -->
              <input type="text" id="office_dept" class="form-input h-4 p-0" />
            </div>
          </div>

          <!-- 2. NAME (Approximately 60% width) - FIXED FOR ALIGNMENT -->
          <div class="w-3/5 flex border-l border-white">
            <!-- Label 2. NAME: (Vertically spans the whole row) -->
            <div class="w-1/5 flex items-start pt-1 pl-1 pr-0 font-bold">
              2. NAME:
            </div>
            <!-- Name inputs (Last, First, Middle) -->
            <div class="flex-grow flex justify-between">
              <!-- Last Name -->
              <div class="w-1/3 flex flex-col border-l border-white">
                <!-- Top Part: (Last) Label (Fixed height h-6 to match 1. Label area) -->
                <div class="h-6 flex items-center justify-center pt-1">
                  <span class="text-center text-xxs">(Last)</span>
                </div>
                <!-- Bottom Part: Input Field (Flex-grow to push input line down) -->
                <div class="flex-grow flex items-end px-1 pb-1 pt-0">
                  <input
                    type="text"
                    id="name_last"
                    class="form-input text-center h-4 p-0"
                  />
                </div>
              </div>
              <!-- First Name -->
              <div class="w-1/3 flex flex-col border-l border-white">
                <div class="h-6 flex items-center justify-center pt-1">
                  <span class="text-center text-xxs">(First)</span>
                </div>
                <div class="flex-grow flex items-end px-1 pb-1 pt-0">
                  <input
                    type="text"
                    id="name_first"
                    class="form-input text-center h-4 p-0"
                  />
                </div>
              </div>
              <!-- Middle Name -->
              <div class="w-1/3 flex flex-col border-l border-white">
                <div class="h-6 flex items-center justify-center pt-1">
                  <span class="text-center text-xxs">(Middle)</span>
                </div>
                <div class="flex-grow flex items-end px-1 pb-1 pt-0">
                  <input
                    type="text"
                    id="name_middle"
                    class="form-input text-center h-4 p-0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 2: 3. DATE OF FILING, 4. POSITION, 5. SALARY -->
        <div class="flex p-1">
          <!-- 3. DATE OF FILING (Approx 1/3) -->
          <div class="w-1/3 flex items-center">
            <span class="font-bold">3. DATE OF FILING</span>
            <input
              type="date"
              id="date_filing"
              class="form-underline inline-block w-auto h-4 p-0 ml-1 flex-grow text-xs"
            />
          </div>
          <!-- 4. POSITION (Approx 1/3) -->
          <div class="w-1/3 flex items-center pl-2 border-l border-white">
            <span class="font-bold">4. POSITION</span>
            <input
              type="text"
              id="position"
              class="form-underline text-center w-auto ml-1 p-0 flex-grow text-xs"
            />
          </div>
          <!-- 5. SALARY (Approx 1/3) -->
          <div class="w-1/3 flex items-center pl-2 border-l border-white">
            <span class="font-bold">5. SALARY</span>
            <input
              type="text"
              id="salary"
              class="form-underline text-center inline-block w-auto ml-1 p-0 flex-grow text-xs"
            />
          </div>
        </div>
      </div>

      <!-- 6. DETAILS OF APPLICATION -->
      <div class="text-xs form-box mt-3">
        <div class="text-center font-bold form-line p-1">
          6. DETAILS OF APPLICATION
        </div>

        <div class="flex">
          <!-- 6.A TYPE OF LEAVE -->
          <div class="w-1/2 p-2 form-line border-r border-black">
            <div class="font-bold mb-1">6.A TYPE OF LEAVE TO BE AVAILED OF</div>
            <div class="space-y-1">
              <label class="checkbox-label" for="vl">
                <input type="checkbox" id="vl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Vacation Leave (Sec. 51, Rule XVI, Omnibus Rules Implementing
                  E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="mfl">
                <input type="checkbox" id="mfl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Mandatory/Forced Leave (Sec. 25, Rule XVI, Omnibus Rules
                  Implementing E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="sl">
                <input type="checkbox" id="sl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Sick Leave (Sec. 43, Rule XVI, Omnibus Rules Implementing
                  E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="ml">
                <input type="checkbox" id="ml" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Maternity Leave (R.A. No. 11210 / IRR issued by CSC, DOLE and
                  SSS)</span
                >
              </label>
              <label class="checkbox-label" for="pl">
                <input type="checkbox" id="pl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Paternity Leave (R.A. No. 8187 / CSC MC No. 71, s. 1998, as
                  amended)</span
                >
              </label>
              <label class="checkbox-label" for="spl">
                <input type="checkbox" id="spl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Special Privilege Leave (Sec. 21, Rule XVI, Omnibus Rules
                  Implementing E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="solopl">
                <input type="checkbox" id="solopl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Solo Parent Leave (RA No. 8972 / CSC MC No. 8, s. 2004)</span
                >
              </label>
              <label class="checkbox-label" for="studyl">
                <input type="checkbox" id="studyl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Study Leave (Sec. 68, Rule XVI, Omnibus Rules Implementing
                  E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="vawc">
                <input type="checkbox" id="vawc" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >10-Day VAWC Leave (RA No. 9262 / CSC MC No. 15, s.
                  2005)</span
                >
              </label>
              <label class="checkbox-label" for="rehab">
                <input type="checkbox" id="rehab" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Rehabilitation Privilege (Sec. 55, Rule XVI, Omnibus Rules
                  Implementing E.O. No. 292)</span
                >
              </label>
              <label class="checkbox-label" for="splwomen">
                <input type="checkbox" id="splwomen" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Special Leave Benefits for Women (RA No. 9710 / CSC MC No.
                  25, s. 2010)</span
                >
              </label>
              <label class="checkbox-label" for="secl">
                <input type="checkbox" id="secl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Special Emergency (Calamity) Leave (CSC MC No. 2, s. 2012, as
                  amended)</span
                >
              </label>
              <label class="checkbox-label" for="adoptl">
                <input type="checkbox" id="adoptl" name="leave_type" /><span
                  class="ml-1 text-xxs"
                  >Adoption Leave (R.A. No. 8552)</span
                >
              </label>
              <div class="mt-2 text-xxs flex items-center">
                Others:
                <input
                  type="text"
                  id="other_leave_specify"
                  class="form-underline w-2/3 ml-1 p-0 text-xs"
                />
              </div>
            </div>
          </div>

          <!-- 6.B DETAILS OF LEAVE -->
          <div class="w-1/2 p-2 form-line">
            <div class="font-bold mb-1">6.B DETAILS OF LEAVE</div>

            <!-- Vacation/Special Privilege Leave -->
            <div class="mb-3">
              <p class="text-xxs font-semibold mb-1">
                In case of Vacation/Special Privilege Leave:
              </p>
              <div class="ml-3 space-y-1">
                <label class="checkbox-label" for="loc_ph">
                  <input type="checkbox" id="loc_ph" name="vl_loc" /><span
                    class="ml-1 text-xxs w-full flex items-center"
                    >Within the Philippines
                    <input
                      type="text"
                      id="vl_loc_within_specify"
                      class="form-underline w-3/5 ml-1 p-0 text-xs"
                  /></span>
                </label>
                <label class="checkbox-label" for="loc_ab">
                  <input type="checkbox" id="loc_ab" name="vl_loc" /><span
                    class="ml-1 text-xxs w-full flex items-center"
                    >Abroad (Specify)
                    <input
                      type="text"
                      id="vl_loc_abroad_specify"
                      class="form-underline w-3/5 ml-1 p-0 text-xs"
                  /></span>
                </label>
              </div>
            </div>

            <!-- Sick Leave -->
            <div class="mb-3">
              <p class="text-xxs font-semibold mb-1">In case of Sick Leave:</p>
              <div class="ml-3 space-y-1">
                <label class="checkbox-label" for="sl_hosp">
                  <input type="checkbox" id="sl_hosp" name="sl_type" /><span
                    class="ml-1 text-xxs w-full flex flex-col"
                    >In Hospital (Specify Illness)
                    <input
                      type="text"
                      id="sl_hosp_illness"
                      class="form-underline w-full p-0 text-xs mt-1"
                  /></span>
                </label>
                <label class="checkbox-label" for="sl_out">
                  <input type="checkbox" id="sl_out" name="sl_type" /><span
                    class="ml-1 text-xxs w-full flex flex-col"
                    >Out Patient (Specify Illness)
                    <input
                      type="text"
                      id="sl_out_illness"
                      class="form-underline w-full p-0 text-xs mt-1"
                  /></span>
                </label>
              </div>
            </div>

            <!-- Special Leave Benefits for Women -->
            <div class="mb-3">
              <p class="text-xxs font-semibold mb-1">
                In case of Special Leave Benefits for Women:
              </p>
              <div class="ml-3">
                <span class="text-xxs w-full flex flex-col"
                  >(Specify Illness)
                  <input
                    type="text"
                    id="splwomen_illness_input"
                    class="form-underline w-full ml-1 p-0 text-xs mt-1"
                /></span>
              </div>
            </div>

            <!-- Study Leave -->
            <div class="mb-3">
              <p class="text-xxs font-semibold mb-1">In case of Study Leave:</p>
              <div class="ml-3 space-y-1">
                <label class="checkbox-label" for="sl_md">
                  <input type="checkbox" id="sl_md" name="study_type" /><span
                    class="ml-1 text-xxs"
                    >Completion of Master's Degree</span
                  >
                </label>
                <label class="checkbox-label" for="sl_bar">
                  <input type="checkbox" id="sl_bar" name="study_type" /><span
                    class="ml-1 text-xxs"
                    >BAR/Board Examination Review</span
                  >
                </label>
                <div class="text-xxs">
                  Other purpose:
                  <input
                    type="text"
                    id="study_other_input"
                    class="form-underline w-3/4 ml-1 p-0 text-xs"
                  />
                </div>
              </div>
            </div>

            <!-- Others (Monetization/Terminal Leave) -->
            <div>
              <p class="text-xxs font-semibold mb-1">Others:</p>
              <div class="ml-3 space-y-1">
                <label class="checkbox-label" for="mlc">
                  <input type="checkbox" id="mlc" name="other_type" /><span
                    class="ml-1 text-xxs"
                    >Monetization of Leave Credits</span
                  >
                </label>
                <label class="checkbox-label" for="tl">
                  <input type="checkbox" id="tl" name="other_type" /><span
                    class="ml-1 text-xxs"
                    >Terminal Leave</span
                  >
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="flex">
          <!-- 6.C NUMBER OF WORKING DAYS APPLIED FOR -->
          <div
            class="w-2/4 p-2 form-line border-t border-black border-r border-black"
          >
            <div class="font-bold mb-1">
              6.C NUMBER OF WORKING DAYS APPLIED FOR
            </div>
            <!-- Line for number of days -->
            <input
              type="text"
              id="num_working_days"
              class="form-underline w-3/4 p-0 text-center text-sm mb-2"
              placeholder=""
            />
            <div class="font-bold mb-1">INCLUSIVE DATES</div>
            <!-- Line for inclusive dates -->
            <input
              type="text"
              id="inclusive_dates"
              class="form-underline w-3/4 p-0 text-center text-sm"
              placeholder=""
            />
          </div>

          <!-- 6.D COMMUTATION -->
          <div class="w-2/4 p-2 form-line border-t border-black">
            <div class="font-bold mb-3">6.D COMMUTATION</div>
            <div class="space-y-2 text-sm">
              <label class="checkbox-label" for="comm_not_req">
                <input
                  type="radio"
                  id="comm_not_req"
                  name="commutation"
                  value="Not Requested"
                  class="mt-0.5"
                /><span class="ml-1">Not Requested</span>
              </label>
              <label class="checkbox-label" for="comm_req">
                <input
                  type="radio"
                  id="comm_req"
                  name="commutation"
                  value="Requested"
                  class="mt-0.5"
                /><span class="ml-1">Requested</span>
              </label>
            </div>
            <!-- Signature of Applicant -->
            <div class="mt-6 text-center pt-2 text-xs">
              <div id="signature_container" class="w-full">
                <input
                  type="text"
                  id="signature_text"
                  class="form-underline w-full text-center text-sm"
                  placeholder=""
                />
              </div>
              <p class="mt-0.5 font-normal">(Signature of Applicant)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 7. DETAILS OF ACTION ON APPLICATION (FIXED to match reference image) -->
      <div class="text-xs form-box mt-3">
        <div class="text-center font-bold form-line p-1">
          7. DETAILS OF ACTION ON APPLICATION
        </div>

        <div class="flex form-line">
          <!-- 7.A Certification of Leave Credits -->
          <div class="w-1/2 p-2 border-r border-black">
            <div class="font-bold mb-1">7.A CERTIFICATION OF LEAVE CREDITS</div>
            <p class="text-sm mb-2">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As
              of
              <input
                type="text"
                class="form-underline inline-block w-2/5 text-center p-0 h-4 ml-1"
              />
            </p>

            <!-- Leave Credit Table (Fixed with explicit borders) -->
            <div class="border border-black mt-2">
              <!-- Header Row -->
              <div class="flex font-bold text-xxs">
                <div class="w-1/3 p-1"></div>
                <div class="w-1/3 p-1 text-center border-l border-black">
                  Vacation Leave
                </div>
                <div class="w-1/3 p-1 text-center border-l border-black">
                  Sick Leave
                </div>
              </div>
              <!-- Total Earned Row -->
              <div class="flex text-xxs border-t border-black">
                <div
                  class="w-1/3 p-1 font-semibold text-right border-r border-black"
                >
                  Total Earned
                </div>
                <input
                  type="text"
                  class="w-1/3 p-1 text-center border-r border-black"
                />
                <input
                  type="text"
                  class="w-1/3 p-1 text-center"
                  style="border: none; outline: none; padding: 1px"
                />
              </div>
              <!-- Less this application Row -->
              <div class="flex text-xxs border-t border-black">
                <div
                  class="w-1/3 p-1 font-semibold text-right border-r border-black"
                >
                  Less this application
                </div>
                <input
                  type="text"
                  class="w-1/3 p-1 text-center border-r border-black"
                />
                <input
                  type="text"
                  class="w-1/3 p-1 text-center"
                  style="border: none; outline: none; padding: 1px"
                />
              </div>
              <!-- Balance Row -->
              <div class="flex text-xxs border-t border-black">
                <div
                  class="w-1/3 p-1 font-semibold text-right border-r border-black"
                >
                  Balance
                </div>
                <input
                  type="text"
                  class="w-1/3 p-1 text-center border-r border-black"
                />
                <input
                  type="text"
                  class="w-1/3 p-1 text-center"
                  style="border: none; outline: none; padding: 1px"
                />
              </div>
            </div>

            <div class="mt-8 text-center text-xxs font-semibold pt-2">
              <input
                type="text"
                class="form-underline w-3/4 text-center text-sm"
                placeholder=""
              />
              <p class="mt-0.5 font-normal">(Authorized Officer)</p>
            </div>
          </div>

          <!-- 7.B RECOMMENDATION -->
          <div class="w-1/2 p-2">
            <div class="font-bold mb-3">7.B RECOMMENDATION</div>
            <div class="space-y-2 text-sm">
              <label class="checkbox-label" for="rec_appr">
                <input
                  type="checkbox"
                  id="rec_appr"
                  name="recommendation"
                /><span class="ml-1">For approval</span>
              </label>
              <label class="checkbox-label" for="rec_disappr">
                <input
                  type="checkbox"
                  id="rec_disappr"
                  name="recommendation"
                  class="mt-0.5"
                /><span class="ml-1">For disapproval due to</span>
              </label>
            </div>
            <!-- Multiple lines for disapproval reason -->
            <div class="ml-5 mt-1 space-y-1">
              <input
                type="text"
                class="form-underline w-full p-0 text-xs"
                placeholder=""
              />
              <input
                type="text"
                class="form-underline w-full p-0 text-xs"
                placeholder=""
              />
              <input
                type="text"
                class="form-underline w-full p-0 text-xs"
                placeholder=""
              />
            </div>

            <div class="mt-12 text-center text-xs font-semibold pt-2">
              <input
                type="text"
                class="form-underline w-3/4 text-center text-sm"
                placeholder=""
              />
              <p class="mt-0.5 font-normal">(Authorized Officer)</p>
            </div>
          </div>
        </div>

        <div class="flex form-line border-t border-white">
          <!-- 7.C APPROVED FOR -->
          <div class="w-1/2 p-2 border-r border-white">
            <div class="font-bold mb-3">7.C APPROVED FOR:</div>
            <div class="space-y-2 text-sm">
              <p class="mb-1 flex items-center">
                <input
                  type="text"
                  class="form-underline w-8 text-center mr-1"
                  placeholder="___"
                />
                days with pay
              </p>
              <p class="mb-1 flex items-center">
                <input
                  type="text"
                  class="form-underline w-8 text-center mr-1"
                  placeholder="___"
                />
                days without pay
              </p>
              <p class="mb-1 flex items-center">
                <input
                  type="text"
                  class="form-underline w-8 text-center mr-1"
                  placeholder="___"
                />
                others (Specify)
              </p>
            </div>
          </div>

          <!-- 7.D DISAPPROVED DUE TO -->
          <div class="w-1/2 p-2">
            <div class="font-bold mb-3">7.D DISAPPROVED DUE TO:</div>
            <input
              type="text"
              class="form-underline w-full p-0 text-sm mb-2"
              placeholder=""
            />
            <input
              type="text"
              class="form-underline w-full p-0 text-sm mb-2"
              placeholder=""
            />
            <input
              type="text"
              class="form-underline w-full p-0 text-sm"
              placeholder=""
            />
          </div>
        </div>
        <div class="mt-4 text-center text-xs font-semibold p-2">
          <input
            type="text"
            class="form-underline w-1/4 text-center text-sm"
            placeholder=""
          />
          <p class="mt-0.5 font-normal">(Authorized Official)</p>
        </div>
      </div>

      <!-- Add at the bottom of the form -->
    </div>

    <script>
      // --- Breadcrumb: Show current leave type ---
      document.getElementById("current-leave-type").textContent =
        localStorage.getItem("leaveType") || "Civil Service Form";

      // --- Auto-fill form fields from DB and localStorage ---
      window.onload = function () {
        // Fetch current logged-in user (session-backed)
        fetch('/capstone/api/current_user.php')
          .then(res => res.json())
          .then(data => {
            if (data && data.logged_in) {
              document.getElementById('office_dept').value = data.department || '';
              document.getElementById('name_last').value = data.lastname || '';
              document.getElementById('name_first').value = data.firstname || '';
              document.getElementById('name_middle').value = data.mi || '';
              document.getElementById('position').value = data.position || '';
              document.getElementById('salary').value = localStorage.getItem('leaveSalary') || '';
            } else {
              // fallback to employee-info endpoint if needed
              fetch('/capstone/api/employee_info.php?email=' + encodeURIComponent(localStorage.getItem('userEmail')))
                .then(r => r.json()).then(emp => {
                  document.getElementById('office_dept').value = emp.department || '';
                  document.getElementById('name_last').value = emp.lastName || '';
                  document.getElementById('name_first').value = emp.firstName || '';
                  document.getElementById('name_middle').value = emp.middleName || '';
                  document.getElementById('position').value = emp.position || '';
                  document.getElementById('salary').value = localStorage.getItem('leaveSalary') || emp.salary || '';
                }).catch(()=>{});
            }
          }).catch(()=>{});

  // Fetch Dept Heads for dropdown (PHP endpoint)
  fetch("/capstone/api/dept_heads.php")
          .then((res) => res.json())
          .then((heads) => {
            const select = document.getElementById("dept_head_select");
            select.innerHTML = "";
            heads.forEach((h) => {
              const opt = document.createElement("option");
              opt.value = h.email;
              opt.textContent = h.department + " (" + h.name + ")";
              select.appendChild(opt);
            });
          });

        // Auto-check leave type
        const leaveTypeMap = {
          "Vacation Leave": "vl",
          "Sick Leave": "sl",
          "Maternity Leave": "ml",
          "Paternity Leave": "pl",
          "Mandatory Forced Leave": "mfl",
          "Special Privilege Leave": "spl",
          "Study Leave": "studyl",
          "10-Day VAWC Leave": "vawc",
          "Special Leave for Women": "splwomen",
          "Special Emergency (Calamity) Leave": "secl",
          "Adoption Leave": "adoptl",
          "Monetization of Leave Credits": "mlc",
          "Terminal Leave": "tl",
        };
        const leaveType = localStorage.getItem("leaveType");
        if (leaveType && leaveTypeMap[leaveType]) {
          const leaveCheckbox = document.querySelector(
            'input[name="leave_type"][id="' + leaveTypeMap[leaveType] + '"]'
          );
          if (leaveCheckbox) leaveCheckbox.checked = true;
        }

        // Try to read structured details first
        const storedDetailsRaw = localStorage.getItem('leaveDetails');
        let details = null;
        try {
          if (storedDetailsRaw) details = JSON.parse(storedDetailsRaw);
        } catch(e) { details = null; }

        // Set Date of Filing: prefer server-provided applied_at, else localStorage, else today
        const appliedAt = localStorage.getItem('leaveAppliedAt') || localStorage.getItem('leaveAppliedAt');
        const dateFilingInput = document.getElementById('date_filing');
        if (appliedAt) {
          // appliedAt is like '2025-10-07 11:46:13' -> convert to YYYY-MM-DD
          const d = new Date(appliedAt);
          if (!isNaN(d)) dateFilingInput.value = d.toISOString().slice(0,10);
          else {
            // fallback: try to parse manual string
            const dt = appliedAt.split(' ')[0];
            if (dt) dateFilingInput.value = dt;
          }
        } else {
          // default to today
          const today = new Date(); dateFilingInput.value = today.toISOString().slice(0,10);
        }

        if (details && details.section6b) {
          // 6.B Vacation / Special Privilege
          if (details.section6b.vl) {
            const vl = details.section6b.vl;
            // Only populate the specify input for the selected location
            if (vl.location === 'Within PH') {
              document.getElementById('loc_ph').checked = true;
              document.getElementById('loc_ab').checked = false;
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = vl.specify || '';
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = '';
            } else if (vl.location === 'Abroad') {
              document.getElementById('loc_ab').checked = true;
              document.getElementById('loc_ph').checked = false;
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = vl.specify || '';
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = '';
            } else {
              // unknown value: clear both
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = '';
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = '';
            }
          }
          // Sick Leave
          if (details.section6b.sl) {
            const sl = details.section6b.sl;
            // Only populate the matching illness field
            if (sl.type === 'In Hospital') {
              document.getElementById('sl_hosp').checked = true;
              if (document.getElementById('sl_hosp_illness')) document.getElementById('sl_hosp_illness').value = sl.illness || '';
              // clear the other
              if (document.getElementById('sl_out_illness')) document.getElementById('sl_out_illness').value = '';
            } else if (sl.type === 'Out Patient') {
              document.getElementById('sl_out').checked = true;
              if (document.getElementById('sl_out_illness')) document.getElementById('sl_out_illness').value = sl.illness || '';
              // clear the other
              if (document.getElementById('sl_hosp_illness')) document.getElementById('sl_hosp_illness').value = '';
            }
          }
          // Special Leave for Women
          if (details.section6b.splwomen) {
            if (document.getElementById('splwomen_illness_input')) document.getElementById('splwomen_illness_input').value = details.section6b.splwomen.illness || '';
          }
          // Study Leave
          if (details.section6b.study) {
            const st = details.section6b.study;
            document.getElementById('sl_md').checked = (st.purpose === "Master's Degree");
            document.getElementById('sl_bar').checked = (st.purpose && st.purpose.indexOf('BAR') !== -1);
            // only populate the 'other' field when the purpose is an explicit other value
            if (document.getElementById('study_other_input')) {
              if (st.purpose && st.purpose.toLowerCase().indexOf('other') !== -1) document.getElementById('study_other_input').value = st.other || '';
              else document.getElementById('study_other_input').value = '';
            }
          }

          // common fields
          if (details.duration) {
            const durationInput = document.getElementById('num_working_days');
            if (durationInput) durationInput.value = details.duration;
          }
          if (details.dates) {
            const datesInput = document.getElementById('inclusive_dates');
            if (datesInput) datesInput.value = details.dates;
          }
          if (details.reliefOfficer) {
            const reliefInput = document.querySelector('input[type="text"].form-underline.w-full.text-center.text-sm');
            if (reliefInput) reliefInput.value = details.reliefOfficer;
          }
          if (details.commutation === 'Requested') document.getElementById('comm_req').checked = true;
          else document.getElementById('comm_not_req').checked = true;
        } else {
          // Backwards compatibility: read older localStorage keys
          if (
            leaveType === "Vacation Leave" ||
            leaveType === "Special Privilege Leave"
          ) {
            const vl_location = localStorage.getItem("vl_location");
            document.getElementById("loc_ph").checked = vl_location === "Within PH";
            document.getElementById("loc_ab").checked = vl_location === "Abroad";
            if (vl_location === 'Within PH') {
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = localStorage.getItem("vl_location_specify") || '';
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = '';
            } else if (vl_location === 'Abroad') {
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = localStorage.getItem("vl_location_specify") || '';
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = '';
            } else {
              if (document.getElementById('vl_loc_within_specify')) document.getElementById('vl_loc_within_specify').value = '';
              if (document.getElementById('vl_loc_abroad_specify')) document.getElementById('vl_loc_abroad_specify').value = '';
            }
          } else if (leaveType === "Sick Leave") {
            const sl_type = localStorage.getItem("sl_type");
            document.getElementById("sl_hosp").checked = sl_type === "In Hospital";
            document.getElementById("sl_out").checked = sl_type === "Out Patient";
            if (sl_type === 'In Hospital') {
              if (document.getElementById('sl_hosp_illness')) document.getElementById('sl_hosp_illness').value = localStorage.getItem("sl_illness") || '';
              if (document.getElementById('sl_out_illness')) document.getElementById('sl_out_illness').value = '';
            } else if (sl_type === 'Out Patient') {
              if (document.getElementById('sl_out_illness')) document.getElementById('sl_out_illness').value = localStorage.getItem("sl_illness") || '';
              if (document.getElementById('sl_hosp_illness')) document.getElementById('sl_hosp_illness').value = '';
            } else {
              if (document.getElementById('sl_hosp_illness')) document.getElementById('sl_hosp_illness').value = '';
              if (document.getElementById('sl_out_illness')) document.getElementById('sl_out_illness').value = '';
            }
          } else if (leaveType === "Special Leave for Women") {
            if (document.getElementById('splwomen_illness_input')) document.getElementById('splwomen_illness_input').value = localStorage.getItem("splwomen_illness") || '';
          } else if (leaveType === "Study Leave") {
            const study_purpose = localStorage.getItem("study_purpose");
            document.getElementById('sl_md').checked = study_purpose === "Master's Degree";
            document.getElementById('sl_bar').checked = study_purpose === "BAR Review";
            if (document.getElementById('study_other_input')) {
              if (study_purpose && study_purpose.toLowerCase().indexOf('other') !== -1) document.getElementById('study_other_input').value = localStorage.getItem("study_other") || '';
              else document.getElementById('study_other_input').value = '';
            }
          }

          const durationField = document.getElementById('num_working_days');
          if (durationField) durationField.value = localStorage.getItem("leaveDuration") || "";
          const inclusiveField = document.getElementById('inclusive_dates');
          if (inclusiveField) inclusiveField.value = (localStorage.getItem("leaveStartDate") || "") + " - " + (localStorage.getItem("leaveEndDate") || "");
          const reliefField = document.querySelector('input[type="text"].form-underline.w-full.text-center.text-sm');
          if (reliefField) reliefField.value = localStorage.getItem("leaveReliefOfficer") || "";
          if (localStorage.getItem("leaveCommutation") === "Requested") {
            document.getElementById("comm_req").checked = true;
          } else {
            document.getElementById("comm_not_req").checked = true;
          }
        }

        // Display signature image. Prefer data URI stored as 'leaveSignatureData' (no server file needed),
        // otherwise fall back to path stored as 'leaveSignaturePath' (legacy behavior).
        const sigData = localStorage.getItem('leaveSignatureData');
        const sigPath = localStorage.getItem('leaveSignaturePath');
        if (sigData || sigPath) {
          // Place the image inside the signature area (replace the input)
          const sigContainer = document.getElementById('signature_container');
          if (sigContainer) {
            sigContainer.innerHTML = ''; // clear
            const wrapper = document.createElement('div');
            wrapper.style.width = '100%';
            wrapper.style.height = '70px';
            wrapper.style.display = 'flex';
            wrapper.style.alignItems = 'center';
            wrapper.style.justifyContent = 'center';

            const img = document.createElement('img');
            img.alt = 'Signature';
            img.style.maxHeight = '60px';
            img.style.objectFit = 'contain';
            img.style.display = 'block';

            if (sigData) {
              // data URI available -> use it immediately
              img.src = sigData;
            } else {
              // Build candidate src paths and try them until one loads
              const raw = String(sigPath || '');
              const cleaned = raw.replace(/^\/+/, ''); // remove leading slashes
              const candidates = [];
              if (/^https?:\/\//i.test(raw)) candidates.push(raw);
              candidates.push('../' + cleaned);
              candidates.push('/' + cleaned);
              candidates.push(cleaned);

              img.onerror = function () {
                if (candidates.length > 0) {
                  img.src = candidates.shift();
                } else {
                  img.remove();
                  const txt = document.createElement('div');
                  txt.textContent = '(Signature not found)';
                  txt.style.fontStyle = 'italic';
                  txt.style.color = '#666';
                  wrapper.appendChild(txt);
                }
              };
              img.src = candidates.shift();
            }

            wrapper.appendChild(img);
            sigContainer.appendChild(wrapper);
          }
        }
        // ...other auto-fill logic as needed...
      };

      // --- Submit Button Logic ---
      document.getElementById("submitLeaveBtn").onclick = function () {
        // Gather all form data
        const formData = {
          employee_email: localStorage.getItem("userEmail"),
          deptHead: document.getElementById("dept_head_select").value,
          leave_type: localStorage.getItem("leaveType"),
          dates:
            (localStorage.getItem("leaveStartDate") || "") +
            " - " +
            (localStorage.getItem("leaveEndDate") || ""),
          reason: localStorage.getItem("leaveReason") || "",
          // Add more fields as needed
        };
        // Send to Dept Head (API call)
        fetch("/capstone/api/submit-leave.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData),
        }).then((res) => {
          if (res.ok) {
            alert("Leave request submitted!");
            window.location.href = "leave-history.html";
          } else {
            alert("Error submitting leave request.");
          }
        });
      };
    </script>
  </body>
</html>
