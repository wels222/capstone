<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Company Events</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .modal-bg {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 1000;
      }
    </style>
  </head>
  <body class="bg-gray-100 p-6 lg:p-10">
    <header
      class="bg-white rounded-xl shadow-md p-4 flex items-center justify-between z-10 sticky top-0"
    >
      <div class="flex items-center space-x-4">
        <div
          class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"
        >
          <img src="../assets/logo.png" alt="Logo" class="rounded-full" />
        </div>
        <h1 id="header-title" class="text-xl font-bold text-gray-800">
          Dashboard
        </h1>
      </div>
      <div class="flex items-center space-x-4">
        <a
          href="dashboard.php"
          class="text-gray-600 hover:text-blue-600 transition-colors"
        >
          <i class="fas fa-bell text-lg"></i>
        </a>
        <a
          href="dashboard.php"
          class="text-gray-600 hover:text-blue-600 transition-colors"
        >
          <i class="fas fa-home text-lg"></i>
        </a>
        <img
          id="profileIcon"
          src="https://placehold.co/40x40/FF5733/FFFFFF?text=P"
          alt="Profile"
          class="w-10 h-10 rounded-full cursor-pointer"
        />
        <!-- Profile Modal -->
        <div
          id="profileModal"
          class="fixed inset-0 hidden items-center justify-center modal-bg z-50"
        >
          <div
            class="bg-white rounded-lg shadow-xl p-6 w-full max-w-xs mx-4 flex flex-col items-center"
          >
            <img
              src="https://placehold.co/80x80/FFD700/000000?text=W+P"
              alt="Profile"
              class="w-20 h-20 rounded-full mb-4"
            />
            <button
              id="logoutBtn"
              class="w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 mb-2"
            >
              Log out
            </button>
            <button
              id="closeProfileModal"
              class="w-full px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="mt-8 lg:mt-12">
      <div class="bg-white rounded-xl shadow-md p-6 lg:p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Upcoming Events</h2>
        <div id="events-container" class="space-y-6">
          <!-- Events will be loaded here dynamically -->
        </div>
      </div>
    </main>

    <!-- Event Detail Modal -->
    <div
      id="event-detail-modal"
      class="fixed inset-0 modal-bg flex items-center justify-center hidden"
    >
      <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-lg mx-auto w-full">
        <div class="flex justify-between items-center mb-4">
          <h3
            id="event-modal-title"
            class="text-2xl font-bold text-gray-800"
          ></h3>
          <button
            id="close-event-detail-modal"
            class="text-gray-500 hover:text-gray-700 text-lg"
          >
            &times;
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <span class="font-semibold text-gray-700">Date:</span>
            <span id="event-modal-date" class="text-gray-600"></span>
          </div>
          <div>
            <span class="font-semibold text-gray-700">Time:</span>
            <span id="event-modal-time" class="text-gray-600"></span>
          </div>
          <div>
            <span class="font-semibold text-gray-700">Location:</span>
            <span id="event-modal-location" class="text-gray-600"></span>
          </div>
          <div>
            <span class="font-semibold text-gray-700">Description:</span>
            <p id="event-modal-description" class="text-gray-600 mt-1"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Event Modal -->
    <div
      id="add-event-modal"
      class="fixed inset-0 modal-bg flex items-center justify-center hidden"
    >
      <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-lg mx-auto w-full">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-gray-800">Add New Event</h3>
          <button
            id="close-add-event-modal"
            class="text-gray-500 hover:text-gray-700 text-lg"
          >
            &times;
          </button>
        </div>
        <form id="add-event-form" class="space-y-4">
          <div>
            <label
              for="event-title"
              class="block text-sm font-medium text-gray-700"
              >Event Title</label
            >
            <input
              type="text"
              id="event-title"
              name="event-title"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="event-date"
              class="block text-sm font-medium text-gray-700"
              >Date</label
            >
            <input
              type="date"
              id="event-date"
              name="event-date"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="event-time"
              class="block text-sm font-medium text-gray-700"
              >Time</label
            >
            <input
              type="time"
              id="event-time"
              name="event-time"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="event-location"
              class="block text-sm font-medium text-gray-700"
              >Location</label
            >
            <input
              type="text"
              id="event-location"
              name="event-location"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label
              for="event-description"
              class="block text-sm font-medium text-gray-700"
              >Description</label
            >
            <textarea
              id="event-description"
              name="event-description"
              rows="3"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            ></textarea>
          </div>
          <div class="flex justify-end space-x-4">
            <button
              type="button"
              id="cancel-add-event"
              class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:bg-gray-100 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors"
            >
              Save Event
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast-notification"
      class="fixed bottom-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl hidden transition-opacity duration-300 ease-in-out"
    >
      Event added successfully!
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- MODAL ELEMENTS ---
        const eventDetailModal = document.getElementById("event-detail-modal");
        const closeEventDetailModalBtn = document.getElementById(
          "close-event-detail-modal"
        );
        const eventsContainer = document.getElementById("events-container");

        // Fetch events from backend
        fetch("../api/get_events.php")
          .then((response) => {
            if (!response.ok) throw new Error("Could not connect to server.");
            return response.json();
          })
          .then((events) => {
            eventsContainer.innerHTML = "";
            if (events && events.length > 0) {
              events.forEach((event) => {
                const eventElement = document.createElement("div");
                eventElement.classList.add(
                  "bg-gray-50",
                  "p-6",
                  "rounded-xl",
                  "shadow-sm",
                  "border",
                  "border-gray-200",
                  "cursor-pointer",
                  "hover:bg-gray-100",
                  "transition-colors"
                );
                eventElement.dataset.eventId = event.id;
                // Format date
                const eventDate = new Date(event.date);
                const day = eventDate.getDate();
                const month = eventDate.toLocaleString("default", {
                  month: "short",
                });
                eventElement.innerHTML = `
                                <div class="flex items-center mb-2">
                                    <div class="flex flex-col items-center justify-center p-2 bg-blue-100 rounded-lg text-blue-600">
                                        <span class="text-xl font-bold">${day}</span>
                                        <span class="text-xs font-semibold">${month}</span>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-bold text-gray-800">${
                                          event.title
                                        }</h3>
                                        <p class="text-sm text-gray-600">${
                                          event.time ? event.time : ""
                                        } - ${
                  event.location ? event.location : ""
                }</p>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500">${
                                  event.description || ""
                                }</p>
                            `;
                eventElement.addEventListener("click", () => {
                  document.getElementById("event-modal-title").textContent =
                    event.title;
                  document.getElementById("event-modal-date").textContent =
                    event.date;
                  document.getElementById("event-modal-time").textContent =
                    event.time || "";
                  document.getElementById("event-modal-location").textContent =
                    event.location || "";
                  document.getElementById(
                    "event-modal-description"
                  ).textContent = event.description || "";
                  eventDetailModal.classList.remove("hidden");
                });
                eventsContainer.appendChild(eventElement);
              });
            } else {
              eventsContainer.innerHTML =
                '<div class="text-gray-500">No events found.</div>';
            }
          })
          .catch((err) => {
            eventsContainer.innerHTML = `<div class="text-red-500">${err.message}</div>`;
          });

        // Event listener to close the Event Detail modal
        if (closeEventDetailModalBtn) {
          closeEventDetailModalBtn.addEventListener("click", () => {
            eventDetailModal.classList.add("hidden");
          });
        }
      });
    </script>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Profile Modal logic
      const profileIcon = document.getElementById("profileIcon");
      const profileModal = document.getElementById("profileModal");
      const logoutBtn = document.getElementById("logoutBtn");
      const closeProfileModal = document.getElementById("closeProfileModal");
      profileIcon.addEventListener("click", () => {
        profileModal.classList.remove("hidden");
        profileModal.classList.add("flex");
      });
      closeProfileModal.addEventListener("click", () => {
        profileModal.classList.add("hidden");
        profileModal.classList.remove("flex");
      });
      logoutBtn.addEventListener("click", () => {
        window.location.href = "logout.php";
      });
      profileModal.addEventListener("click", (e) => {
        if (e.target === profileModal) {
          profileModal.classList.add("hidden");
          profileModal.classList.remove("flex");
        }
      });
    });
  </script>
</html>
